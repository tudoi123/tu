"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[188],{46480:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrencyData=void 0;const o=a(7963),n=a(64942),i=a(23081),s=a(87919),l=r(a(6736));t.default=function(e){let t;function a(e){if(e.priceFormat)return function(e){const t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}(e.priceFormat.toString());switch(e.symbolPosition){case"left":return"%1$s%2$s";case"right":return"%2$s%1$s";case"left_space":return"%1$s %2$s";case"right_space":return"%2$s %1$s"}return"%1$s%2$s"}function r(e){const r=Object.assign(Object.assign({},{code:"USD",symbol:"$",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2}),e);let o=r.precision;null===o?(console.warn("Currency precision is null"),o=NaN):"string"==typeof o&&(o=parseInt(o,10)),t={code:r.code.toString(),symbol:r.symbol.toString(),symbolPosition:r.symbolPosition.toString(),decimalSeparator:r.decimalSeparator.toString(),priceFormat:a(r),thousandSeparator:r.thousandSeparator.toString(),precision:o}}function c(e,a=!1){const r=(0,s.numberFormat)(t,e);if(""===r)return r;const{priceFormat:o,symbol:n,code:l}=t;return(0,i.sprintf)(o,a?l:n,r)}return r(e),{getCurrencyConfig:()=>Object.assign({},t),getDataForCountry:function(e,t={},a={}){const r=t[e];if(!r)return{};const o=a[r.currency_code];return o?{code:r.currency_code,symbol:(0,n.decodeEntities)(o),symbolPosition:r.currency_pos,thousandSeparator:r.thousand_sep,decimalSeparator:r.decimal_sep,precision:r.num_decimals}:{}},setCurrency:r,formatAmount:c,formatCurrency:function(e){return(0,l.default)("Currency().formatCurrency",{version:"5.0.0",alternative:"Currency().formatAmount",plugin:"WooCommerce",hint:"`formatAmount` accepts the same arguments as formatCurrency"}),c(e)},getPriceFormat:a,formatDecimal(e){if("number"!=typeof e&&(e=parseFloat(e)),Number.isNaN(e))return 0;const{precision:a}=t;return Math.round(e*Math.pow(10,a))/Math.pow(10,a)},formatDecimalString(e){if("number"!=typeof e&&(e=parseFloat(e)),Number.isNaN(e))return"";const{precision:a}=t;return e.toFixed(a)},render:e=>("number"!=typeof e&&(e=parseFloat(e)),e<0?(0,o.createElement)("span",{className:"is-negative"},c(e)):c(e))}},t.getCurrencyData=function(){return(0,l.default)("getCurrencyData",{version:"3.1.0",alternative:"CurrencyFactory.getDataForCountry",plugin:"WooCommerce Admin",hint:"Pass in the country, locale data, and symbol info to use getDataForCountry"}),{US:{code:"USD",symbol:"$",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2},EU:{code:"EUR",symbol:"€",symbolPosition:"left",thousandSeparator:".",decimalSeparator:",",precision:2},IN:{code:"INR",symbol:"₹",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2},GB:{code:"GBP",symbol:"£",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2},BR:{code:"BRL",symbol:"R$",symbolPosition:"left",thousandSeparator:".",decimalSeparator:",",precision:2},VN:{code:"VND",symbol:"₫",symbolPosition:"right",thousandSeparator:".",decimalSeparator:",",precision:1},ID:{code:"IDR",symbol:"Rp",symbolPosition:"left",thousandSeparator:".",decimalSeparator:",",precision:0},BD:{code:"BDT",symbol:"৳",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:0},PK:{code:"PKR",symbol:"₨",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2},RU:{code:"RUB",symbol:"₽",symbolPosition:"right",thousandSeparator:" ",decimalSeparator:",",precision:2},TR:{code:"TRY",symbol:"₺",symbolPosition:"left",thousandSeparator:".",decimalSeparator:",",precision:2},MX:{code:"MXN",symbol:"$",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2},CA:{code:"CAD",symbol:"$",symbolPosition:"left",thousandSeparator:",",decimalSeparator:".",precision:2}}}},87919:function(e,t,a){a.r(t),a.d(t,{calculateDelta:function(){return s},formatValue:function(){return i},numberFormat:function(){return n}});var r=a(10110),o=a.n(r);function n({precision:e=null,decimalSeparator:t=".",thousandSeparator:a=","},r){if(void 0===r)return"";if("number"!=typeof r&&(r=parseFloat(r)),isNaN(r))return"";let n=null===e?NaN:Number(e);if(isNaN(n)){const[,e]=r.toString().split(".");n=e?e.length:0}return o()(r,n,t,a)}function i(e,t,a){if(!Number.isFinite(a))return null;switch(t){case"average":return Math.round(a);case"number":return n({...e,precision:null},a)}return null}function s(e,t){return Number.isFinite(e)&&Number.isFinite(t)?0===t?0:Math.round((e-t)/t*100):null}},41506:function(e,t,a){var r=a(99581),o=a(26952),n=a(81433),i=a(44520),s=a(79821),l=a(3939),c=a(7936),u=a(15312),m=a(10159),d=a(70079),p=a(38088),b=a(99357),f=a(41896),v=a(47478),y=a(35250);function h(e){let{onClick:t}=e;const{query:a}=(0,m.Z)((e=>({query:e(f.storeName).getCurrentQuery()}))),{primary:r,secondary:o}=(0,b.getCurrentDates)(a,"period=month&compare=previous_year");return(0,y.jsxs)("div",{className:"woocommerce-filters-filter",children:[(0,y.jsx)("span",{className:"woocommerce-filters-label",children:(0,c.__)("Date range:","mailpoet")}),(0,y.jsx)("div",{className:"components-dropdown",tabIndex:-1,children:(0,y.jsx)("button",{type:"button","aria-expanded":"false",onClick:t,className:"components-button woocommerce-dropdown-button is-multi-line",children:(0,y.jsxs)("div",{className:"woocommerce-dropdown-button__labels",children:[(0,y.jsxs)("span",{children:[r.label," (",r.range,")"]}),(0,y.jsx)("span",{children:(0,c.sprintf)((0,c.__)("vs. %1$s (%2$s)","mailpoet"),o.label,o.range)})]})})})]})}function _(){const[e,t]=d.useState(!1),a=p.Hooks.applyFilters("mailpoet_analytics_filter",(0,y.jsx)(h,{onClick:()=>{t(!0)}}));return(0,y.jsxs)("div",{className:"mailpoet-analytics-filter-element woocommerce-layout",children:[a,e&&(0,y.jsx)(v.ZG,{tracking:{utm_medium:"upsell_modal",utm_campaign:"automation_analytics_date_range_filter"},onRequestClose:()=>t(!1),children:(0,c.__)("Changing the date range is a premium feature.","mailpoet")})]})}var g=a(12025);function x(){const{automation:e}=(0,m.Z)((e=>({automation:e(f.storeName).getAutomation()})));return(0,y.jsxs)("header",{className:"mailpoet-analytics-header",children:[(0,y.jsx)(_,{}),(0,y.jsx)(l.ZP,{href:(0,u.f)(g.x.urls.automationEditor,{id:e.id}),isPrimary:!0,children:(0,c.__)("Edit automation","mailpoet")})]})}var S=a(83047),w=a(92295),N=a(46480),j=a.n(N);function C(e){return j()(g.x.WooCommerceStoreConfig).formatAmount(e)}function k(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"current";const r=(0,n.select)(f.storeName).getSection("overview");if(void 0===r.data)return;const o=r.data[e]??null,i=(null===(t=r.data)||void 0===t?void 0:t.sent)??null;if(!(o&&i&&o[a]&&i[a]))return 0;const s=100*o[a]/i[a]/100;return s}function P(e){const t=k(e,"current"),a=k(e,"previous");if(void 0!==t&&void 0!==a)return 0===a?0:(t>a?t-a:a-t)/a*100}function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"current";const a=(0,n.select)(f.storeName).getSection("overview");if(void 0===a.data)return;const r=a.data[e]??null;return r&&r[t]?r[t]:0}function D(e){const t=F(e,"current"),a=F(e,"previous");if(void 0===t||void 0===a)return;const r=t>a?t-a:a-t;return 0===r||0===a?0:r/a*100}function $(){const{overview:e,hasEmails:t}=(0,m.Z)((e=>({overview:e(f.storeName).getSection("overview"),hasEmails:e(f.storeName).automationHasEmails()}))),a=new Intl.NumberFormat(w.locale.toString(),{style:"percent",maximumFractionDigits:2}),r=new Intl.NumberFormat(w.locale.toString()),o=[];return void 0!==e.data&&(o.push((0,y.jsx)(S.SummaryNumber,{label:(0,c.__)("Opened","mailpoet"),value:a.format(k("opened")),delta:P("opened").toFixed(2)},"overview-opened")),o.push((0,y.jsx)(S.SummaryNumber,{label:(0,c.__)("Clicked","mailpoet"),value:a.format(k("clicked")),delta:P("clicked").toFixed(2)},"overview-clicked"))),void 0!==e.data&&g.x.isWoocommerceActive&&(o.push((0,y.jsx)(S.SummaryNumber,{label:(0,c._x)("Orders","WooCommerce orders","mailpoet"),delta:D("orders").toFixed(2),value:r.format(F("orders"))},"overview-orders")),o.push((0,y.jsx)(S.SummaryNumber,{label:(0,c.__)("Revenue","mailpoet"),delta:D("revenue").toFixed(2),value:C(void 0!==e.data?e.data.revenue.current:0)},"overview-revenue"))),t?(0,y.jsxs)("div",{className:"mailpoet-automation-analytics-overview",children:[(0,y.jsx)("h1",{children:(0,c.__)("Overview","mailpoet")}),0===o.length&&(0,y.jsx)(S.SummaryListPlaceholder,{numberOfItems:g.x.isWoocommerceActive?4:2},"placeholder"),0!==o.length&&(0,y.jsx)(S.SummaryList,{label:(0,c.__)("Overview","mailpoet"),children:()=>o})]}):null}var E=a(16374),R=a(92893);function O(){return(0,y.jsx)("p",{children:"Automation flow"})}var A=a(63920),L=a(66510),I=a(97471),M=a(96756),T=a(74457);function U(e){let{id:t,previewUrl:a}=e;const r=[{title:(0,c.__)("Preview email","mailpoet"),icon:I.Z,onClick:()=>{window.location.href=a}},{title:(0,c.__)("Edit email","mailpoet"),icon:M.Z,onClick:()=>{window.location.href=`?page=mailpoet-newsletter-editor&id=${t}&context=automation`}}];return(0,y.jsxs)("div",{className:"mailpoet-analytics-email-actions",children:[(0,y.jsx)("p",{children:(0,y.jsx)("a",{href:`admin.php?page=mailpoet-newsletters#/stats/${t}`,children:(0,c.__)("Statistics","mailpoet")})}),(0,y.jsx)(L.Z,{label:(0,c.__)("More","mailpoet"),icon:T.Z,controls:r,popoverProps:{position:"bottom left"}})]})}function Z(e){let{value:t,subValue:a,badge:r,badgeType:o,className:n}=e;const i=r?(0,y.jsx)("span",{className:"mailpoet-analytics-badge",children:r}):null,s=(0,y.jsxs)("div",{className:`mailpoet-analytics-main-value ${n??""} ${o??""}`,children:[i,t]}),l=(0,y.jsx)(y.Fragment,{children:" "});return(0,y.jsxs)("div",{className:"mailpoet-automation-analytics-emails-table-cell",children:[s,(0,y.jsxs)("p",{className:"mailpoet-automation-analytics-table-subvalue",children:[a,(void 0===a||0===a.toString().length)&&l]})]})}const V=Intl.NumberFormat(w.locale.toString(),{style:"percent",maximumFractionDigits:2});function B(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===t)return 0;const r=100*e/t;return a?r-100:r}const W=[{key:"email",label:(0,c.__)("Email","mailpoet")},{key:"sent",label:(0,c.__)("Sent","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"opened",label:(0,c.__)("Opened","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"clicked",label:(0,c.__)("Clicked","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"orders",label:(0,c.__)("Orders","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"revenue",label:(0,c.__)("Revenue","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"unsubscribed",label:(0,c.__)("Unsubscribed","mailpoet"),isLeftAligned:!1,isNumeric:!0},{key:"actions",label:""}];function q(){const{overview:e}=(0,m.Z)((e=>({overview:e(f.storeName).getSection("overview")}))),[t,a]=(0,d.useState)(void 0),[r,o]=(0,d.useState)(1),[n,i]=(0,d.useState)(25);(0,d.useEffect)((()=>{a(void 0!==e.data?Object.values(e.data.emails).splice((r-1)*n,n):void 0)}),[e.data,r,n]);const s=void 0!==t?t.map((e=>{const t=B(e.clicked.current,e.sent.current),a=(r=t)>3?{badge:(0,c.__)("Excellent","mailpoet"),badgeType:"mailpoet-analytics-badge-success"}:r>1?{badge:(0,c.__)("Good","mailpoet"),badgeType:"mailpoet-analytics-badge-success"}:{badge:(0,c.__)("Average","mailpoet"),badgeType:"mailpoet-analytics-badge-warning"};var r;return[{display:(0,y.jsx)(Z,{className:"mailpoet-automation-analytics-email-name",value:e.name,subValue:(0,c.sprintf)((0,c.__)("Email %d","mailpoet"),e.order)}),value:e.name},{display:(0,y.jsx)(Z,{value:(0,y.jsx)(A.Z,{text:(0,c.__)("View sending status","mailpoet"),children:(0,y.jsx)("a",{href:`?page=mailpoet-newsletters#/sending-status/${e.id}`,children:`${e.sent.current}`})}),subValue:V.format(B(e.sent.current,e.sent.previous,!0)/100)}),value:e.sent.current},{display:(0,y.jsx)(Z,{value:e.opened.current,subValue:V.format(B(e.opened.current,e.sent.current)/100)}),value:e.opened.current},{display:(0,y.jsx)(Z,{value:e.clicked.current,className:e.sent.current>0?"mailpoet-automation-analytics-email-clicked":"",subValue:V.format(t/100),badge:e.sent.current>0?a.badge:void 0,badgeType:e.sent.current>0?a.badgeType:void 0}),value:e.clicked.current},{display:(0,y.jsx)(Z,{value:(0,y.jsx)(A.Z,{text:(0,c.__)("View orders","mailpoet"),children:(0,y.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),(()=>{const e=document.querySelector(".mailpoet-analytics-tab-orders");null==e||e.click()})()},children:`${e.orders.current}`})})}),value:e.orders.current},{display:(0,y.jsx)(Z,{value:C(e.revenue.current)}),value:e.revenue.current},{display:(0,y.jsx)(Z,{value:e.unsubscribed.current}),value:e.unsubscribed.current},{display:(0,y.jsx)(U,{id:e.id,previewUrl:e.previewUrl}),value:null}]})):[],l=function(e){if(0===e.length)return[];const t=e.reduce(((e,t)=>(e.sent+=t.sent.current,e.opened+=t.opened.current,e.clicked+=t.clicked.current,e.orders+=t.orders.current,e.unsubscribed+=t.unsubscribed.current,e.revenue+=t.revenue.current,e)),{sent:0,opened:0,clicked:0,orders:0,unsubscribed:0,revenue:0}),a=Intl.NumberFormat(w.locale.toString(),{notation:"compact"});return[{label:(0,c.__)("sent","mailpoet"),value:a.format(t.sent)},{label:(0,c.__)("opened","mailpoet"),value:a.format(t.opened)},{label:(0,c.__)("clicked","mailpoet"),value:a.format(t.clicked)},{label:(0,c.__)("orders","mailpoet"),value:a.format(t.orders)},{label:(0,c.__)("revenue","mailpoet"),value:C(t.revenue)},{label:(0,c.__)("unsubscribed","mailpoet"),value:a.format(t.unsubscribed)}]}(t??[]);return(0,y.jsx)(S.TableCard,{title:"",caption:"",onQueryChange:t=>r=>{"paged"===t?(o(r),a(void 0!==e.data?Object.values(e.data.emails).splice((r-1)*n,n):void 0)):"per_page"===t&&(o(1),i(r),a(void 0!==e.data?Object.values(e.data.emails).splice(0,r):void 0))},query:{paged:r,sort:{key:"email",direction:"asc"}},rows:s,headers:W,showMenu:!1,rowsPerPage:n,onRowClick:()=>{},totalRows:void 0!==e.data?Object.values(e.data.emails).length:0,summary:l,isLoading:void 0===e.data})}function H(){return(0,y.jsx)("p",{children:"Orders"})}function G(){return(0,y.jsx)("p",{children:"Subscribers"})}function Q(){const e=(0,E.k6)(),t=(0,E.TH)(),{hasEmails:a}=(0,m.Z)((e=>({hasEmails:e(f.storeName).automationHasEmails()}))),r=(0,d.useMemo)((()=>new URLSearchParams(t.search)),[t]),o=r.get("tab")??"automation-flow",n=[{name:"automation-flow",className:"mailpoet-analytics-tab-flow",title:(0,c.__)("Automation flow","mailpoet")}];a&&(n.push({name:"automation-emails",className:"mailpoet-analytics-tab-emails",title:(0,c.__)("Emails","mailpoet")}),n.push({name:"automation-orders",className:"mailpoet-analytics-tab-orders",title:(0,c._x)("Orders","WooCommerce orders","mailpoet")}),n.push({name:"automation-subscribers",className:"mailpoet-analytics-tab-subscribers",title:(0,c.__)("Subscribers","mailpoet")}));const i=(0,d.useCallback)((t=>{const a=new URLSearchParams({...Object.fromEntries(r.entries()),tab:t});e.push({search:a.toString()})}),[r,e]);return(0,y.jsx)("div",{className:"mailpoet-analytics-tabs",children:(0,y.jsx)(R.Z,{onSelect:i,initialTabName:o,tabs:n,children:e=>{switch(e.name){case"automation-flow":return(0,y.jsx)(O,{});case"automation-emails":return(0,y.jsx)(q,{});case"automation-orders":return(0,y.jsx)(H,{});case"automation-subscribers":return(0,y.jsx)(G,{});default:return null}}})})}var K=a(59481),X=a(77159);const Y=window.mailpoet_automation_api;function z(){return(0,y.jsxs)("div",{className:"mailpoet-automation-analytics",children:[(0,y.jsx)(x,{}),(0,y.jsx)($,{}),(0,y.jsx)(Q,{})]})}function J(){return(0,y.jsxs)(o.BrowserRouter,{children:[(0,y.jsx)(i.Q,{}),(0,y.jsx)(s.w,{}),(0,y.jsx)(z,{})]})}(()=>{const e=(window.mailpoet_locale_full??document.documentElement.lang??"en").replace("_","-");try{new Intl.Locale(e)}catch(t){try{return new Intl.Locale(e.split("-")[0])}catch(e){return new Intl.Locale("en")}}})(),window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("mailpoet_automation_analytics");e&&((0,f.createStore)(),(0,K.y)(),(()=>{const e=`${Y.root}/mailpoet/v1/`;X.default.use(X.default.createRootURLMiddleware(e)),X.default.use(X.default.createNonceMiddleware(Y.nonce))})(),(0,n.select)(f.storeName).getSections().forEach((e=>{(0,n.dispatch)(f.storeName).updateSection(e)})),r.render((0,y.jsx)(J,{}),e))}))},65311:function(e){e.exports=jQuery}},function(e){e.O(0,[351],(function(){return 41506,e(e.s=41506)})),e.O()}]);